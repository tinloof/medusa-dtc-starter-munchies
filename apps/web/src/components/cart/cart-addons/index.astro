---
import type { HttpTypes } from "@medusajs/types";
import type { Header } from "@packages/sanity/types";
import { getProductsByIds } from "@/lib/medusa/products";
import { getRegion } from "@/lib/medusa/regions";
import { CartAddonsCarousel } from "./cart-addons-carousel";

interface Props {
  addons: Header["cartAddons"];
  cart: HttpTypes.StoreCart | null;
  countryCode: string;
}

const { addons, cart, countryCode } = Astro.props;

const region = await getRegion(countryCode);

if (!region) {
  return null;
}

const addonIds = (addons?.map(({ _ref }) => _ref) ?? []).filter(
  (id) => !cart?.items?.map(({ product_id }) => product_id)?.includes(id)
);
const isEmptyCart = !cart?.items || cart.items.length === 0;

const { products } = await getProductsByIds(addonIds, region.id);
---

<CartAddonsCarousel
  client:load
  products={products}
  isEmptyCart={isEmptyCart}
  regionId={region.id}
/>
