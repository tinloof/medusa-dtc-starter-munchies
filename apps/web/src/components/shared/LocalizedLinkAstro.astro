---
import config from "@/config";

interface Props {
  href: string;
  class?: string;
  scroll?: boolean;
  [key: string]: any;
}

const { href, class: className, scroll = false, ...rest } = Astro.props;

// Get country code from middleware
const countryCode = Astro.locals.countryCode || config.defaultCountryCode;
const isDefaultCountry = countryCode === config.defaultCountryCode;

const normalizedPath = href.toString();
const isExternalLink = normalizedPath.startsWith("https://") || normalizedPath.startsWith("http://");
const isDeepLink = normalizedPath.startsWith("#");

// Add country code prefix for non-default countries
const localizedHref =
  isExternalLink || isDeepLink || isDefaultCountry
    ? href
    : `/${countryCode}${normalizedPath.startsWith("/") ? "" : "/"}${href}`;
---

<a
  href={localizedHref}
  class={className}
  {...isExternalLink ? { target: "_blank", rel: "noopener noreferrer" } : {}}
  {...rest}
>
  <slot />
</a>
